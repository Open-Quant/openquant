---
import Layout from "../layouts/Layout.astro";
import { moduleDocs } from "../data/moduleDocs";

const base = import.meta.env.BASE_URL.endsWith("/")
  ? import.meta.env.BASE_URL.slice(0, -1)
  : import.meta.env.BASE_URL;

const subjects = [
  "Event-Driven Data and Labeling",
  "Sampling, Validation and ML Diagnostics",
  "Position Sizing and Trade Construction",
  "Portfolio Construction and Risk",
  "Market Microstructure, Dependence and Regime Detection",
];

const grouped = subjects.map((subject) => ({
  subject,
  modules: moduleDocs.filter((doc) => doc.subject === subject),
}));
---
<Layout title="Subjects (AFML) â€¢ OpenQuant-rs" description="AFML-style subject map with dedicated pages for each OpenQuant module.">
  <section class="hero">
    <h1>Subjects (AFML-Aligned)</h1>
    <p class="muted">Each module now has a dedicated page with mathematical definitions, API surface, and implementation-oriented code examples.</p>
  </section>

  <h2>Subject Dividers</h2>
  <table>
    <thead>
      <tr>
        <th>Divider</th>
        <th>AFML Orientation</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Event-Driven Data and Labeling</td>
        <td>Event bars, filters, labeling, and sample weighting.</td>
      </tr>
      <tr>
        <td>Sampling, Validation and ML Diagnostics</td>
        <td>Leakage-aware validation, bootstrap, and model diagnostics.</td>
      </tr>
      <tr>
        <td>Position Sizing and Trade Construction</td>
        <td>Sizing transforms, execution-aware construction, synthetic ETF/roll.</td>
      </tr>
      <tr>
        <td>Portfolio Construction and Risk</td>
        <td>Optimization, clustering allocation, and risk overlays.</td>
      </tr>
      <tr>
        <td>Market Microstructure, Dependence and Regime Detection</td>
        <td>Microstructure estimators, dependence metrics, structural breaks.</td>
      </tr>
    </tbody>
  </table>

  {grouped.map((group) => (
    <section>
      <h2>{group.subject}</h2>
      <div class="grid">
        {group.modules.map((doc) => (
          <article class="card">
            <h3><a href={`${base}/module/${doc.slug}`}>{doc.module}</a></h3>
            <p class="muted">{doc.summary}</p>
          </article>
        ))}
      </div>
    </section>
  ))}
</Layout>
